<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Portail Captif • La Farm</title>
  <style>
    /* (reprenez votre CSS aéré ici) */
  </style>
  <script src="https://cdn.auth0.com/js/auth0/9.19/auth0.min.js"></script>
</head>
<body>
  <div class="container">
    <header>
      <img src="LAFARM_Noir.png" alt="Logo La Farm">
      <h1>Bienvenue sur le Wi-Fi La Farm</h1>
      <p>Identifiez-vous pour accéder à Internet</p>
    </header>

    <button id="btn-google">Se connecter avec Google</button>
    <button id="btn-facebook">Se connecter avec Facebook</button>

    <hr>

    <form id="emailForm">
      <label>
        Votre e-mail *
        <input type="email" name="email" required placeholder="prenom.nom@exemple.com">
      </label>
      <fieldset>
        <legend>Consentements *</legend>
        <label>
          <input type="checkbox" name="consent-rgpd" required>
          J’accepte la collecte et l’utilisation de mon e-mail pour la newsletter (RGPD).
        </label>
      </fieldset>
      <button type="submit">Envoyer</button>
    </form>

    <footer>
      <a href="cgu.html" target="_blank">CGU</a> •
      <a href="politique.html" target="_blank">Politique de confidentialité</a>
    </footer>
  </div>

  <script>
    // === Initialisation OAuth (Auth0) ===
    const auth0 = new auth0.WebAuth({
      domain:   'VOTRE_DOMAIN.auth0.com',
      clientID: 'VOTRE_CLIENT_ID',
      redirectUri: window.location.origin + '/lafarm-portal/callback.html',
      responseType: 'token id_token',
      scope: 'openid profile email'
    });

    document.getElementById('btn-google').onclick = () =>
      auth0.authorize({ connection: 'google-oauth2' });
    document.getElementById('btn-facebook').onclick = () =>
      auth0.authorize({ connection: 'facebook' });

    // === Formulaire e-mail ===
    document.getElementById('emailForm').addEventListener('submit', e => {
      e.preventDefault();
      // Ici, vous pouvez enregistrer l’e-mail dans votre back-end si besoin
      authorizeOmada();
    });

    function authorizeOmada() {
      const p = new URLSearchParams(location.search);
      fetch(
        `https://euw1-omada-cloud.tplinkcloud.com/api/v2/captiveportal/authorize?` +
        `mac=${p.get('mac')}&ip=${p.get('ip')}` +
        `&ap=${p.get('ap')}&ssid=${p.get('ssid')}`,
        { headers:{ 'Authorization':'Bearer 181f1a86985947db8d0236ee0fd4da4d' } }
      ).then(() => {
        window.location = 'https://www.lafarm.example';
      });
    }
  </script>
</body>
</html>
